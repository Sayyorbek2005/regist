;/*FB_PKG_DELIM*/

__d("MWV2SetupS2SLoggingShared",["I64","LSIntEnum","MWChatInteraction","MWLSLogSend","MWSharedS2SBaseAnnotations","MWVersion","ReQL","ReQLSubscribe","asyncToGeneratorRuntime","err","gkx","sendToSentQPLLogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(a,b){d("sendToSentQPLLogger").markSendToSentPoint(a,"received_successful_server_ack"),d("sendToSentQPLLogger").markSendToSentSuccess(a),d("MWChatInteraction").remove(d("MWChatInteraction").s2sKey(b))}function k(a,b){d("sendToSentQPLLogger").markSendToSentFail(a,"send_message_server_error",c("err")("send_message_server_error")),d("MWChatInteraction").remove(d("MWChatInteraction").s2sKey(b))}function l(a){d("sendToSentQPLLogger").markSendToSentPoint(a,"sending_message")}function a(a){var e=a.db,f=a.isCommunityEvent,g=a.isFirstMessage,m=g===void 0?!1:g,n=a.isMessageRequest;g=a.isWorkChat;var o=g===void 0?!1:g,p=a.s2sInstanceKey;g=a.sendFirstMessageSeparately;var q=g===void 0?!1:g,r=a.source,s=a.threadType,t=a.traceSendMessageAPI,u={isCommunityEvent:f,isMessageRequest:n,mwVersion:d("MWVersion").v2,source:r,threadType:s};return function(a){d("MWLSLogSend").logSentHeroInteraction(t,a,u);d("MWChatInteraction").set(d("MWChatInteraction").s2sKey(a),String(p));d("sendToSentQPLLogger").addSendToSentAnnotations(p,{bool:{subscription_points_gk:!0},string:{entrypoint:d("MWSharedS2SBaseAnnotations").getEntrypointAnnotation(r),is_community_event:f===!0?"true":"false",is_first_message:m===!0?"true":"false",is_message_request:n===!0?"true":"false",offline_threading_id:o&&c("gkx")("9326")?a:null,send_first_message_separately:q===!0?"true":"false",thread_type:s==null?"unknown":(h||(h=d("I64"))).to_string(s)}});var g=!1,v=d("ReQL").fromTableAscending(e.tables.messages.index("optimistic")).getKeyRange(a),w=d("ReQLSubscribe").subscribeToFirst(v,function(b){b!=null&&(h||(h=d("I64"))).equal(b.sendStatusV2,(i||(i=d("LSIntEnum"))).ofNumber(2))?(g=!0,j(p,a),w()):b!=null&&(h||(h=d("I64"))).equal(b.sendStatusV2,(i||(i=d("LSIntEnum"))).ofNumber(4))?(g=!0,k(p,a),w()):b!=null&&(h||(h=d("I64"))).equal(b.sendStatusV2,(i||(i=d("LSIntEnum"))).ofNumber(1))&&l(p)});window.setTimeout(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(!g){var a=(yield d("ReQL").firstAsync(v));g||d("sendToSentQPLLogger").addSendToSentAnnotations(p,{string:{status_after_10s:a?""+(i||(i=d("LSIntEnum"))).toNumber(a.sendStatusV2):"none"}})}}),1e4);window.setTimeout(function(){w()},12e4)}}g["default"]=a}),98);
__d("issueLSAudioMediaSendJob",["I64","LSDatabaseSingletonLazyWrapper","LSFactory","LSInsertNewMediaSendStoredProcedure","LSMarkSubJobCompletedV2StoredProcedure","MWPComposerMediaUploadUtil","MWPOpenComposerUtils","ReQL","asyncToGeneratorRuntime","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,b,c,e){if(a==null)return;if(!a.startsWith("blob:"))return;var f={contents:function(){}};f.contents=d("ReQL").fromTableAscending(c.tables.attachments).getKeyRange(e).subscribe(function(c,d){if(d.operation==="put"){c=d.value;if(c.attachmentFbid!==b.toString())return;d=c.playableUrl;d!=null&&!d.startsWith("blob:")&&(f.contents(),URL.revokeObjectURL(a))}})}function a(a,b,c,d,e,f,g,h,i,k,l){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,g,j,k,l,m,n,o,p,q){yield c("LSInsertNewMediaSendStoredProcedure")(c("LSFactory")(a),{attachmentType:m.attachment_type,inMessageIndex:(h||(h=d("I64"))).zero,isSecure:!1,offlineAttachmentId:k,offlineThreadingId:l,sendByServer:!1,shouldTranscode:!1,useDoublePhase:!1});a=function(a,g){if(g==null||g.length===0)return;var n=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield c("LSDatabaseSingletonLazyWrapper")());return a.runInTransaction(function(){var f=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){b=c("LSFactory")(b);yield c("LSMarkSubJobCompletedV2StoredProcedure")(b,{fbid:(h||(h=d("I64"))).of_string(g),offlineAttachmentId:k});yield d("MWPOpenComposerUtils").resumeSendJob(b,l,j);i(m.playable_url,g,a,e)});return function(a){return f.apply(this,arguments)}}(),"readwrite",void 0,void 0,f.id+":99")});return function(){return a.apply(this,arguments)}}();c("promiseDone")(n(),function(){p==null||p(a)})};var r=function(a,b){q==null||q((b=b.response.getErrorDescriptionString())!=null?b:"unknown_upload_failure",a)};yield d("MWPComposerMediaUploadUtil").startUpload(o,void 0,a,r,!0,[n.file],[k],void 0,void 0,n.waveformData,void 0,h.to_string(g))});return j.apply(this,arguments)}g["default"]=a}),98);
__d("useEnabledForWorkchatOnly",["MessengerSurfaceType","WorkGalahadMWChatTabContext.react","react"],(function(a,b,c,d,e,f,g){"use strict";var h;b=h||d("react");var i=b.useContext,j=b.useMemo;function a(){var a=i(d("WorkGalahadMWChatTabContext.react").context);return j(function(){return a.surface===d("MessengerSurfaceType").workQuickchat||a.surface===d("MessengerSurfaceType").workChat||a.surface===d("MessengerSurfaceType").workMeetingsInCall},[a])}g["default"]=a}),98);
__d("useMWLSDefaultThreadSourceWithResetBasedOnThreadType",["LSThreadAttributionTypeUtil","MWGenAIUtils","react","useLSMessagingSource"],(function(a,b,c,d,e,f,g){"use strict";var h,i=(h||d("react")).useCallback;function a(){var a=c("useLSMessagingSource")();return i(function(b){return d("MWGenAIUtils").isMetaAIThread(b)?d("LSThreadAttributionTypeUtil").getSourceWithoutReset(b,a):d("LSThreadAttributionTypeUtil").getSourceAndResetAttribution(b,a)},[a])}g["default"]=a}),98);
__d("useMWV2SendOpenMessageImplShared",["ArmadilloDataTraceCheckPoint","ChatGeminiDisplayContextProvider.react","I64","IGDGetMessagePluginInfo","IGDThreadTTLCUtils","Int64Hooks","LSAppendDataTraceAddonStoredProcedure","LSAuthorityLevel","LSFactory","LSIntEnum","LSMailboxType","LSMessageReplySourceType","LSMessageReplySourceTypeV2","LSOptimisticSendMessageV2StoredProcedure","LSPendingTasksPluginType","LSShape","MWPActor.react","MWPReplyContext.react","MWPSendMessageLogger","MessagePowerUp","MessagingAttachmentType","Promise","ReQL","ReQLSuspense","asyncToGeneratorRuntime","gkx","isMWBumpMessage","justknobx","react","sendToSentQPLLogger","useLSMessagingInitiatingSource","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m=(k||d("react")).useContext;function n(a,b,c){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){e!=null&&c("gkx")("23995")&&(yield c("LSAppendDataTraceAddonStoredProcedure")(c("LSFactory")(a),{checkPointId:d("ArmadilloDataTraceCheckPoint").armadilloTlcControlOpenThread,dataTraceId:e,syncChannel:(l||(l=d("I64"))).minus_one,tags:b}))});return o.apply(this,arguments)}function a(a){var e=a.authorityLevel,g=a.disableMarkRead,k=a.ephemeralDurationInSec,o=a.onOptimisticMessageCreation,p=a.skipUrlPreviewGen,q=a.threadKey,r=a.threadType,s=d("MWPActor.react").useActor();a=m(d("MWPReplyContext.react").MWPReplyContext);var t=a.reply,u=c("useLSMessagingInitiatingSource")(),v=(i||(i=c("useReStore")))();a=d("ChatGeminiDisplayContextProvider.react").useChatGeminiDisplayContext();var w=a.sideChatMainMessageId;a=d("ReQLSuspense").useFirst(function(){return(t==null?void 0:t.messageId)==null?d("ReQL").empty():d("ReQL").fromTableAscending(v.tables.messages.index("messageId")).getKeyRange(t.messageId)},[t==null?void 0:t.messageId,v.tables.messages],f.id+":138");var x=c("isMWBumpMessage")(a==null?void 0:a.replyType)?a==null?void 0:a.replySourceId:t==null?void 0:t.messageId;return d("Int64Hooks").useCallbackInt64(function(a,f){var i=f.accessibilityLabel,m=f.afterSend,y=f.attributionAppId,z=f.dataclassParams,A=f.dataTraceId,B=f.externalAttachmentUrl,C=f.hotEmojiSize,D=f.logSendPoint,E=f.mentionData,F=f.messageText,G=f.messageTypeParams,H=f.multitabEnv,I=f.optimisticAttachmentPreview,J=f.platformToken,K=f.pluginType,L=f.profileRanges,M=f.richTextFormatType,N=f.s2sInstanceKey,O=f.setupS2SLogging,P=f.source,Q=f.stickerID,aa=f.traceSendMessageAPI,R=f.transaction;return S(R);function S(a){return T.apply(this,arguments)}function T(){T=b("asyncToGeneratorRuntime").asyncToGenerator(function*(f){var v=c("LSFactory")(f),S=c("gkx")("24135");yield n(f,(l||(l=d("I64"))).to_string(q),A);var T=G.hasAttachment;T=T===void 0?!1:T;var U=G.hasGif;U=U===void 0?!1:U;var V=G.hasHotEmoji;V=V===void 0?!1:V;var W=G.hasLinks;W=W===void 0?!1:W;var X=G.hasSticker;X=X===void 0?!1:X;var Y=G.hasText;Y=Y===void 0?!1:Y;var Z=(yield f.threads.get(q)),$=W?d("IGDThreadTTLCUtils").isInstamadilloTTLCLinkEnabled(Z):d("IGDThreadTTLCUtils").isInstamadilloTTLCTextEnabled(Z);Z=(yield d("IGDGetMessagePluginInfo").IGDGetMessagePluginInfo(f,t,function(){return(h||(h=b("Promise"))).resolve({openEb:$,pluginType:$?(j||(j=d("LSIntEnum"))).ofNumber(c("LSPendingTasksPluginType").IGD_INSTAMADILLO):K})}));f=Z.openEb;Z=Z.pluginType;v=(yield c("LSOptimisticSendMessageV2StoredProcedure")(v,{dataclassParams:z!=null?JSON.stringify(z):void 0,extraSendMessageParams:d("LSShape").ofRecord({attribution_app_id:y,calculate_denormalizations:!1,data_trace_id:A!=null?A:void 0,ephemeral_duration_in_sec:k,external_attachment_url:B,hot_emoji_size:C,initiating_source:u,is_exclusive_to_subthread:w!=null,mark_read:g===!0?!1:(l||(l=d("I64"))).ge(e,(j||(j=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE)),mention_data:E,multitab_env:H,openEb:f,optimistic_attachment_preview:I,platform_token:J,plugin_type:Z,power_up_style:(j||(j=d("LSIntEnum"))).ofNumber(c("MessagePowerUp").NONE),qpl_instance_key:N.toString(),reply_source_id:x,reply_source_type:t!=null?(j||(j=d("LSIntEnum"))).ofNumber(c("LSMessageReplySourceType").MESSAGE):void 0,reply_source_type_v2:t!=null?(j||(j=d("LSIntEnum"))).ofNumber(c("LSMessageReplySourceTypeV2").MESSAGE):void 0,rich_text_format_type:M,skip_url_preview_gen:p,source:P,sticker_id:Q,subthread_parent_message_id:w!=null?w:void 0,text_has_links:W&&S}),mailboxType:j.ofNumber(c("LSMailboxType").MESSENGER),metadataDataclass:c("justknobx")._("4710")?JSON.stringify({media_accessibility_metadata:{alt_text:U?i:null}}):null,senderId:s,text:F,threadKey:q,threadType:r}));D("create_optimistic_message_end");d("MWPSendMessageLogger").log(a,q,r,s,void 0,[],P,c("MessagingAttachmentType").NONE,t!=null,Z,$,k);if(!T||U||X||V){S=v[0];O(S);aa.addAnnotationBoolean("is_instamadillo_ttlc",$&&f===!0);d("sendToSentQPLLogger").addSendToSentAnnotations(N,{bool:{is_instamadillo_ttlc:$&&f===!0}})}o!=null&&o({TAG:0,hasHotEmoji:V,hasLink:W,hasMention:L!=null&&L.length>0,isGIF:U,isReply:!!(t&&t.messageId!==""),isSticker:X,isText:Y,offlineThreadingId:v[0]});m!=null&&(yield m(R));return v});return T.apply(this,arguments)}},[q,t,k,u,w,g,e,x,p,s,r,o])}g["default"]=a}),98);
__d("useMWV2SendOpenMessageImpl",["useMWV2SendOpenMessageImplShared"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.disableMarkRead,d=a.ephemeralDurationInSec,e=a.onOptimisticMessageCreation,f=a.skipUrlPreviewGen;a=a.thread;return c("useMWV2SendOpenMessageImplShared")({authorityLevel:a.authorityLevel,disableMarkRead:b,ephemeralDurationInSec:d,onOptimisticMessageCreation:e,skipUrlPreviewGen:f,threadKey:a.threadKey,threadType:a.threadType})}g["default"]=a}),98);
__d("useMWV2SendOpenVoiceClipImplShared",["I64","IGDGetMessagePluginInfo","IGDThreadTTLCUtils","Int64Hooks","LSFactory","LSIntEnum","LSLocalApplyOptimisticMessageWithAttachmentsV2StoredProcedure","LSMessageReplySourceType","LSMessageReplySourceTypeV2","LSPendingTasksPluginType","LSShape","LSVec","MWMediaTraceHandler","MWPActor.react","MWPComposerMediaUploadUtil","MWPReplyContext.react","MessagingLoggingUtils","OfflineThreadingId","Promise","asyncToGeneratorRuntime","issueLSAudioMediaSendJob","issueSendInstamadilloMediaMessage","react","sendToSentQPLLogger","useLSMessagingInitiatingSource"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l=(i||d("react")).useContext;function m(a,b,c,d){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e){b!=null&&(yield d("MWMediaTraceHandler").logMediaSendStart(a,b,c,(k||(k=d("I64"))).of_int32(e)))});return n.apply(this,arguments)}function a(a){var e=a.ephemeralDurationInSec,f=a.onOptimisticMessageCreation,g=a.onUploadFailure,i=a.onUploadStart,n=a.onUploadSuccess,o=a.sendMessageLogger,p=a.skipUrlPreviewGen,q=a.threadKey,r=a.threadType,s=d("MWPActor.react").useActor();a=l(d("MWPReplyContext.react").MWPReplyContext);var t=a.reply,u=c("useLSMessagingInitiatingSource")();return d("Int64Hooks").useCallbackInt64(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,l){var v=l.dataTraceId,w=l.pluginType,x=l.s2sInstanceKey,y=l.setupS2SLogging,z=l.source,A=l.traceSendMessageAPI,B=l.transaction;l=l.voiceClip;var C=c("LSFactory")(B),D=d("OfflineThreadingId").createOfflineThreadingID(),E=d("MWPComposerMediaUploadUtil").getAudioAttachment(D,l.file,l.duration,l.waveformData);yield m(B,v,(k||(k=d("I64"))).one,2);var F=(yield B.threads.get(q)),G=d("IGDThreadTTLCUtils").isInstamadilloTTLCAudioEnabled(F);F=(yield d("IGDGetMessagePluginInfo").IGDGetMessagePluginInfo(B,t,function(){return(h||(h=b("Promise"))).resolve({openEb:G,pluginType:G?(j||(j=d("LSIntEnum"))).ofNumber(c("LSPendingTasksPluginType").IGD_INSTAMADILLO):w})}));var H=F.openEb;F=F.pluginType;C=(yield c("LSLocalApplyOptimisticMessageWithAttachmentsV2StoredProcedure")(C,{extraSendMessageParams:d("LSShape").ofRecord({attachments:c("LSVec").ofArray([d("LSShape").ofRecord(E)]),ephemeral_duration_in_sec:e,external_attachment_url:void 0,initiating_source:u,mark_read:!1,platform_ref:void 0,platform_token:void 0,plugin_type:F,reply_source_id:t==null?void 0:t.messageId,reply_source_type:t!=null?(j||(j=d("LSIntEnum"))).ofNumber(c("LSMessageReplySourceType").MESSAGE):void 0,reply_source_type_v2:t!=null?(j||(j=d("LSIntEnum"))).ofNumber(c("LSMessageReplySourceTypeV2").MESSAGE):void 0,source:z}),senderId:s,threadKey:q,threadType:r}));C=C[0];y(C);A.addAnnotationBoolean("is_instamadillo_ttlc",G&&H===!0);d("sendToSentQPLLogger").addSendToSentAnnotations(x,{bool:{is_instamadillo_ttlc:G&&H===!0}});yield B.messages_optimistic_context.add({externalAttachmentUrl:void 0,initiatingSource:u,markThreadRead:!1,messageId:void 0,offlineThreadingId:C,openEb:H,platformRef:void 0,platformToken:void 0,replySourceId:void 0,replySourceType:void 0,sendType:void 0,skipUrlPreviewGen:p,taskId:k.of_string(C),threadAttributionSource:z,threadKey:q});f!=null&&f({TAG:1,offlineThreadingId:C});F!=null&&(j||(j=d("LSIntEnum"))).unwrapIntEnum(F)===c("LSPendingTasksPluginType").IGD_INSTAMADILLO?yield c("issueSendInstamadilloMediaMessage")(B,[E],C):yield c("issueLSAudioMediaSendJob")(B,q,s,v,D,C,E,l,i,n,g);o(a,{actor:s,attachmentFbids:[E.attachment_fbid],attachmentType:d("MessagingLoggingUtils").convertI64ToAttachmentType(E.attachment_type),hasReply:t!=null,isInstamadilloTTLC:H,key:q,offlineThreadingId:C,pluginType:F,source:z,type:r})});return function(b,c){return a.apply(this,arguments)}}(),[q,e,u,t,s,r,p,f,o,i,n,g])}g["default"]=a}),98);
__d("useMWV2SendOpenVoiceClip",["Int64Hooks","MWPSendMessageLogger","useMWV2SendOpenVoiceClipImplShared"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.ephemeralDurationInSec,e=a.onOptimisticMessageCreation,f=a.onUploadFailure,g=a.onUploadStart,h=a.onUploadSuccess,i=a.skipUrlPreviewGen;a=a.thread;var j=d("Int64Hooks").useCallbackInt64(function(a,c){var e=c.actor,f=c.attachmentFbids,g=c.attachmentType,h=c.hasReply,i=c.isInstamadilloTTLC,j=c.key,k=c.offlineThreadingId,l=c.pluginType,m=c.source;c=c.type;e!=null&&d("MWPSendMessageLogger").log(a,j,c,e,k,f,m,g,h,l,i,b)},[b]);return c("useMWV2SendOpenVoiceClipImplShared")({ephemeralDurationInSec:b,onOptimisticMessageCreation:e,onUploadFailure:f,onUploadStart:g,onUploadSuccess:h,sendMessageLogger:j,skipUrlPreviewGen:i,threadKey:a.threadKey,threadType:a.threadType})}g["default"]=a}),98);
__d("useMWV2SendOpenMessage",["I64","Int64Hooks","LSGenerateTraceId","LSIntEnum","LSMessagingThreadTypeUtil","LSShape","MWPReplyContext.react","MWSharedMsgLogUtils","MWSharedS2SBaseAnnotations","MWV2ComposerActionsContext.react","MWV2SetupS2SLoggingShared","MultipleTabsLogger","ReQL","asyncToGeneratorRuntime","react","sendToSentQPLLogger","useAsyncReStore","useEnabledForWorkchatOnly","useIsMessengerPWA","useMWLSDefaultThreadSourceWithResetBasedOnThreadType","useMWV2SendOpenMessageImpl","useMWV2SendOpenStagedMedia","useMWV2SendOpenVoiceClip"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=(h||d("react")).useContext;function a(a){var e=a.disableMarkRead,g=a.ephemeralDurationInSec,h=a.isIGDW,l=a.onOptimisticMessageCreation,m=a.onUploadFailure,n=a.onUploadStart,o=a.onUploadSuccess,p=a.pluginType,q=a.skipUrlPreviewGen,r=a.thread,s=c("useAsyncReStore")(),t=c("useIsMessengerPWA")();a=k(d("MWPReplyContext.react").MWPReplyContext);var u=a.reply,v=c("useMWLSDefaultThreadSourceWithResetBasedOnThreadType")(),w=c("useMWV2SendOpenVoiceClip")({ephemeralDurationInSec:g,onOptimisticMessageCreation:l,onUploadFailure:m,onUploadStart:n,onUploadSuccess:o,skipUrlPreviewGen:q,thread:r}),x=c("useMWV2SendOpenStagedMedia")(g,l,r,h),y=c("useMWV2SendOpenMessageImpl")({disableMarkRead:e!=null?e:!1,ephemeralDurationInSec:g,onOptimisticMessageCreation:l,skipUrlPreviewGen:q,thread:r}),z=d("LSMessagingThreadTypeUtil").isMessageRequest(r),A=c("useEnabledForWorkchatOnly")();a=k(d("MWV2ComposerActionsContext.react").MWV2ComposerActionsContext);var B=a.onMessageSendAttempt;return d("Int64Hooks").useCallbackInt64(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,g,h,k,l,m,n,o,q,C,D,E,F,G,H,I,J,K,L){C===void 0&&(C=!1);D===void 0&&(D=!1);var M=!1;B==null||B(!0);function N(a){E.addMarkerPoint(a,"AppTiming"),d("sendToSentQPLLogger").markSendToSentPoint(F,a)}var O=v(r.threadKey),P=c("LSGenerateTraceId")(),Q={contents:1};G=r.eventStartTimestampMs!=null;I=r.threadType;var R=(yield s),S=c("MWV2SetupS2SLoggingShared")({db:R,isCommunityEvent:G,isFirstMessage:D,isMessageRequest:z,isWorkChat:A,s2sInstanceKey:F,sendFirstMessageSeparately:C,source:(i||(i=d("LSIntEnum"))).unwrapIntEnum(O),threadType:I,traceSendMessageAPI:E});J=(yield d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(R.tables.media_staging).filter(function(a){return!a.isSent&&(j||(j=d("I64"))).equal(a.threadKey,r.threadKey)})));var T=d("MWSharedS2SBaseAnnotations").getMessageTypeParams({externalAttachmentUrl:l,hotEmojiSize:h,mediaStagings:J,messageText:a,reply:u,stickerId:g,threadType:r.threadType,voiceClip:n}),U=(yield d("MWSharedMsgLogUtils").getSendToSentAnnotations({attachmentTypeParams:T,isPwa:t,source:i.unwrapIntEnum(O),thread:r})),V=(yield d("MultipleTabsLogger").hasMultipleTabs());return R.runInTransaction(function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){d("MWSharedMsgLogUtils").addSendMessageMetadataForInteractionTrace(E,T,r);d("sendToSentQPLLogger").addSendToSentAnnotations(F,U);if(n!=null){(C===!1||D===!0)&&(yield w(R,{dataTraceId:P,pluginType:p,s2sInstanceKey:F,setupS2SLogging:S,source:O,traceSendMessageAPI:E,transaction:b,voiceClip:n}));return}var c=T.hasGif;c=c===void 0?!1:c;var f=T.hasHotEmoji;f=f===void 0?!1:f;var i=T.hasSticker;i=i===void 0?!1:i;var s=T.hasText;s=s===void 0?!1:s;i||f?Q.contents=4:c&&(Q.contents=6);var t=e!=null?d("LSShape").ofRecord({mention_ids:e.map(function(a){return a.id}).join(","),mention_lengths:e.map(function(a){return String(a.length)}).join(","),mention_offsets:e.map(function(a){return String(a.offset)}).join(","),mention_types:e.length!==0?e.map(function(a){return a.type}).join(","):void 0}):void 0;N("create_optimistic_message_start");if(s||i||f||c){M=!0;if(C===!1||D===!0){N("send_message_impl");yield y(R,{accessibilityLabel:L,afterSend:q,attributionAppId:k,dataclassParams:K,dataTraceId:P,externalAttachmentUrl:l,hotEmojiSize:h,logSendPoint:N,mentionData:t,messageText:a,messageTypeParams:T,multitabEnv:V,optimisticAttachmentPreview:m,platformToken:o,pluginType:p,profileRanges:e,richTextFormatType:H,s2sInstanceKey:F,setupS2SLogging:S,source:O,stickerID:g,traceSendMessageAPI:E,transaction:b});if(C===!0){N("send_first_message_separately_return");return}}}else q!=null&&(yield q(b));!i&&!c&&!f&&(yield x(R,{isFirstMessage:D,isFirstMessageText:M,mediaStagings:yield d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(b.media_staging).filter(function(a){return!a.isSent&&(j||(j=d("I64"))).equal(a.threadKey,r.threadKey)})),pluginType:p,s2sInstanceKey:F,sendFirstMessageSeparately:C,setupS2SLogging:S,source:O,traceSendMessageAPI:E,transaction:b}))});return function(a){return c.apply(this,arguments)}}(),"readwrite","ui",void 0,f.id+":245")});return function(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){return a.apply(this,arguments)}}(),[B,v,r,s,z,A,u,t,w,p,y,x])}g["default"]=a}),98);